<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Pending Acceptances</title>
		
		<link rel="stylesheet" type="text/css" href="lib/jqmodal-r14/jqModal.css"/>
		<link rel="stylesheet" type="text/css" href="tool_base.css"/>
		<link rel="stylesheet" type="text/css" href="tool.css"/>
		<link rel="stylesheet" type="text/css" href="lib/dataTables-1.7/css/demo_table.css"/>
		<link rel="stylesheet" type="text/css" href="lib/dataTables-1.7/css/demo_table_jui.css"/>
		<link rel="stylesheet" type="text/css" href="lib/jquery-ui-1.8.2.custom/css/smoothness/jquery-ui-1.8.2.custom.css"/>
		
		
        <link rel="stylesheet" type="text/css" href="lib/jqmodal-r14/jqModal.css" />
        <link rel="stylesheet" type="text/css" href="tool_base.css" />
        <link rel="stylesheet" type="text/css" href="tool.css" />
		
		
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js">
        </script>
        <script type="text/javascript" src="lib/jstree-1.0rc/_lib/jquery.cookie.js">
        </script>
        <script type="text/javascript" src="lib/jstree-1.0rc/jquery.jstree.js">
        </script>
        <script type="text/javascript" src="lib/jqmodal-r14/jqModal.js">
        </script>
        <script type="text/javascript" src="lib/trimpath-template-1.0.38/trimpath-template.js">
        </script>
        <script type="text/javascript" src="lib/dataTables-1.7/js/jquery.dataTables.js">
        </script>
        <script type="text/javascript" src="lib/dataTables-1.6/js/jquery.dataTables.reloadAjax.js">
        </script>
        <script type="text/javascript" src="lib/serverDate.js">
        </script>
		<script type="text/javascript" src="lib/Text.js"></script>
        <script type="text/javascript" src="lib/signup.js">
        </script>
		
		<script type="text/javascript">
			$(function(){
				// Support sorting based on a user.
				$.fn.dataTableExt.oSort["user-asc"] = function(x, y) {
					return $.fn.dataTableExt.oSort["string-asc"](x.name, y.name);
				};
				$.fn.dataTableExt.oSort["user-desc"] = function(x, y) {
					return $.fn.dataTableExt.oSort["string-desc"](x.name, y.name);
				}
				
				var renderUser =  function(user) {
					var details = "";
					if (user) {
						details += '<a href="mailto:' + user.email + '">' + user.name + '</a>';
						if (user.units && user.units.length > 0) {
							details += '<br>'+ user.units.join(" / ");
						}
					}
					return details;
				};
				
				jQuery("#pending-table").dataTable( {
					"bJQueryUI": true,
					"sPaginationType": "full_numbers",
					bProcessing: true,
					"bAutoWidth": true,
					sAjaxSource: "/course-signup/rest/signup/pending",
					aoColumns: [
						{"bVisible": false,},
						{
							"sTitle": "Created",
							"fnRender": function(aObj){
								return Signup.util.formatDuration($.serverDate() - aObj.aData[1])+ " ago"; 
							},
							"bUseRendered": false				
						},
						{"sTitle": "Student"},
						{"sTitle": "Component"},
						{"sTitle": "Supervisor"},
						{"sTitle": "Notes", "sWidth": "20%", "sClass": "signup-notes"},
						{"sTitle": "Status"},
						{"sTitle": "Actions"}
					],
					fnServerData: function( sSource, aoData, fnCallback ) {
						jQuery.ajax( {
							dataType: "json",
							type: "GET",
							url: sSource,
							success: function(result) {
								var data = [];
								$.each(result, function(){
									var course = ['<span class="course-group">'+this.group.title+"</span>"].concat(
										$.map(this.components.concat(), function(component){
											return '<span class="course-component">'+ component.title+ " "+ component.slot + " in "+ component.when+ '</span>';
										})).join("<br>");
									var actions = Signup.signup.formatActions(Signup.signup.getActions(this.status, this.id)); 
									data.push([
										this.id,
										this.created,
										renderUser(this.user),
										course, //TODO Need lots of other bits.
										renderUser(this.supervisor),
										Signup.signup.formatNotes(this.notes),
										this.status,
										actions										
									]);
								});
								fnCallback({
									"aaData": data 
								});
							}
						})
					}
				} );
				
				$("#pending-table a.action" ).live("click", function(e) {
					var url = $(this).attr("href");
					$.ajax({
						"url": url,
						"type": "POST",
						"success": function(data) {
							$("#pending-table").dataTable().fnReloadAjax();
						}
					});
					return false;
				});
			});
		</script>
		
        <style type="text/css">
        	.course-group { /* Used for formatting the summary of the signup. */
        		font-weight: bold;
				line-height: 180%;
        	}
			.course-component {
				margin-left: 1em;
			}
			
			/* From http://psacake.com/web/jl.asp */
            .more {
                position: relative; /*this is the key*/
                font-weight: bold;
            }
			
			.more .full{
				display: none;
                z-index: 24;
			}
			
            .more:hover .full {
                display: block;
                position: absolute;
				font-weight: normal;
                top: 1em;
                left: -30em;
                width: 30em;
                border: 1px solid #000;
				padding: 0.5em;
                background-color: #fff;
                color: #000;
                text-align: left;
            }
        
        </style>
    </head>
    <body>
    	<div id="toolbar" >
        	<ul class="navIntraTool actionToolBar">
            <li><span><a href="index.html">Course Signup</a></span></li>
            <li><span><a href="my.html">My Courses</a></span></li>
            <li><span>Pending Acceptances</span></li>
            <li><span><a href="admin.html">Course Administration</a></span></li>
			<li><span><a href="debug.html">Debug</a></span></li>
			</ul>
        </div>
		<div>
			<p>These are the students who have signed up for a course that need your approval.</p>
		</div>
		<div style="margin:2%" >
		<table id="pending-table">
		</table>
		</div>
		
		
    </body>
</html>